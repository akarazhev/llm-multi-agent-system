%% Component Architecture Diagram
%% Detailed component view with technology stack

graph LR
    subgraph "Presentation Layer"
        A1[Angular 20<br/>TypeScript<br/>Material Design 3]
        A2[HTTP Services<br/>RxJS Observables]
        A3[WebSocket Service<br/>Real-time Updates]
    end

    subgraph "API Layer"
        B1[FastAPI<br/>Python 3.12<br/>Pydantic Validation]
        B2[REST Routers<br/>/api/agents<br/>/api/workflows<br/>/api/projects]
        B3[WebSocket Router<br/>/ws/workflows]
        B4[CORS Middleware<br/>Auth Middleware]
    end

    subgraph "Business Logic Layer"
        C1[LangGraph Orchestrator<br/>State Machine<br/>Checkpointing]
        C2[Task Manager<br/>Dependency Resolution<br/>Queue Management]
        C3[Workflow Engine<br/>Template System<br/>Execution Control]
        C4[Orchestrator Bridge<br/>Service Integration]
    end

    subgraph "Agent Layer"
        D1[Base Agent<br/>Abstract Class<br/>Common Functionality]
        D2[Business Analyst<br/>Requirements Analysis]
        D3[Developer<br/>Architecture & Code]
        D4[QA Engineer<br/>Testing & QA]
        D5[DevOps Engineer<br/>Infrastructure]
        D6[Technical Writer<br/>Documentation]
    end

    subgraph "LLM Integration"
        E1[LLM Client Pool<br/>Connection Pooling<br/>Retry Logic]
        E2[Local llama-server<br/>Devstral 2-24B<br/>OpenAI-compatible API]
        E3[External Providers<br/>OpenAI / Anthropic<br/>Optional Fallback]
    end

    subgraph "Data Access Layer"
        F1[PostgreSQL Adapter<br/>SQLAlchemy ORM<br/>Alembic Migrations]
        F2[ChromaDB Client<br/>Vector Operations<br/>Embedding Storage]
        F3[Redis Client<br/>Caching<br/>Session Storage]
        F4[File Writer<br/>Code Parsing<br/>File Operations]
    end

    subgraph "Data Storage"
        G1[(PostgreSQL 16<br/>Workflows<br/>Projects<br/>Agents)]
        G2[(ChromaDB<br/>Embeddings<br/>Vector Search)]
        G3[(Redis 7+<br/>Cache<br/>Sessions)]
        G4[(SQLite<br/>Checkpoints<br/>Workflow State)]
        G5[(File System<br/>Workspace<br/>Generated Files)]
    end

    subgraph "Infrastructure"
        H1[Docker Compose<br/>Container Orchestration]
        H2[Keycloak<br/>OAuth 2.0<br/>JWT Tokens]
        H3[nginx<br/>Static Files<br/>Reverse Proxy]
    end

    %% Presentation connections
    A1 --> A2
    A1 --> A3
    A2 --> B1
    A3 --> B3

    %% API connections
    B1 --> B2
    B1 --> B3
    B1 --> B4
    B2 --> C1
    B3 --> C1
    B4 --> H2

    %% Business logic connections
    C1 --> C2
    C1 --> C3
    C1 --> C4
    C1 --> D1
    C2 --> D1
    C3 --> D1

    %% Agent connections
    D1 --> D2
    D1 --> D3
    D1 --> D4
    D1 --> D5
    D1 --> D6
    D2 --> E1
    D3 --> E1
    D4 --> E1
    D5 --> E1
    D6 --> E1

    %% LLM connections
    E1 --> E2
    E1 -.-> E3

    %% Data access connections
    C1 --> F1
    C1 --> F2
    C1 --> F3
    C1 --> F4
    F1 --> G1
    F2 --> G2
    F3 --> G3
    C1 --> G4
    F4 --> G5

    %% Infrastructure
    H1 --> B1
    H1 --> G1
    H1 --> H2
    H1 --> A1

    %% Styling
    classDef presentation fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef api fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef business fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef agent fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef llm fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef data fill:#e0e0e0,stroke:#424242,stroke-width:2px
    classDef storage fill:#b2dfdb,stroke:#00695c,stroke-width:2px
    classDef infra fill:#fff9c4,stroke:#f9a825,stroke-width:2px

    class A1,A2,A3 presentation
    class B1,B2,B3,B4 api
    class C1,C2,C3,C4 business
    class D1,D2,D3,D4,D5,D6 agent
    class E1,E2,E3 llm
    class F1,F2,F3,F4 data
    class G1,G2,G3,G4,G5 storage
    class H1,H2,H3 infra
